<!DOCTYPE html>
<html>
<head>
  <title>Singapore Police NPC Boundaries (Google Maps)</title>
  <meta charset="utf-8" />
  <style>
    body { margin: 0; }
    #map { height: 100vh; width: 100%; }
  </style>
</head>

<body>
  <div id="map"></div>

  <script>
    async function initMap() {

      // 1. Initialise Google Map
      const map = new google.maps.Map(document.getElementById("map"), {
        center: { lat: 1.3521, lng: 103.8198 },
        zoom: 11,
        mapTypeId: "roadmap"
      });

      const datasetId = "d_89b44df21fccc4f51390eaff16aa1fe8";
      const pollUrl = `https://api-open.data.gov.sg/v1/public/api/datasets/${datasetId}/poll-download`;

      try {
        // 2. Call poll-download
        let response = await fetch(pollUrl);
        if (!response.ok) throw new Error("Poll-download failed");

        const pollData = await response.json();
        if (pollData.code !== 0) throw new Error(pollData.errMsg);

        // 3. Fetch actual GeoJSON file
        const geoJsonUrl = pollData.data.url;
        response = await fetch(geoJsonUrl);
        if (!response.ok) throw new Error("GeoJSON fetch failed");

        const geoJson = await response.json();

        // 4. Add GeoJSON to Google Maps
        map.data.addGeoJson(geoJson);

        // 5. Style NPC boundaries
        map.data.setStyle({
          fillColor: "#0047AB",
          fillOpacity: 0.25,
          strokeColor: "#0047AB",
          strokeWeight: 2
        });

        // 6. Info window on click
        const infoWindow = new google.maps.InfoWindow();

        map.data.addListener("click", (event) => {
          const name =
            event.feature.getProperty("name") ||
            event.feature.getProperty("npc_name") ||
            "NPC";

          infoWindow.setContent(`<b>NPC Name:</b> ${name}`);
          infoWindow.setPosition(event.latLng);
          infoWindow.open(map);
        });

      } catch (error) {
        console.error("Error loading NPC data:", error);
      }
    }
  </script>

  <!-- Google Maps JS API -->
  <script
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCRHYlg2978t2LjP6o4mirP3kUD_GylLgA&callback=initMap"
    async defer>
  </script>

</body>
</html>
